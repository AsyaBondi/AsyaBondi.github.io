<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ff6b9d">
    <title>–ü–æ–∏—Å–∫ –∞–Ω–∏–º–µ - Asya Anime</title>
    <link rel="stylesheet" href="static/css/mobile.css">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="mobile-header">
        <div class="header-content">
            <button class="back-button" onclick="history.back()">‚Üê</button>
            <h1 class="header-title">Asya Anime</h1>
            <div class="header-spacer"></div>
        </div>
    </header>

    <!-- Search Section -->
    <section class="search-section">
        <div class="search-container">
            <div class="search-input-wrapper">
                <input
                    type="text"
                    id="searchInput"
                    class="search-input"
                    placeholder="–ü–æ–∏—Å–∫ –∞–Ω–∏–º–µ..."
                    value="{{ search_query }}"
                    autocomplete="off"
                >
                <button class="search-clear" id="clearButton" style="display: none;">‚úï</button>
            </div>
            <button class="search-button" id="searchButton">
                <span class="search-icon">üîç</span>
            </button>
        </div>
    </section>

    <!-- Results Section -->
    <section class="results-section">
        {% if search_query %}
            {% if anime_list %}
                <div class="results-header">
                    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>
                    <span class="results-count">{{ anime_list|length }} –Ω–∞–π–¥–µ–Ω–æ</span>
                </div>

                <div class="anime-grid" id="animeGrid">
                    {% for anime in anime_list %}
                    <a href="/anime/{{ anime.id }}" class="anime-card-link">
                        <div class="anime-card">
                            <div class="card-image">
                                <div class="card-poster" style="background: {% if anime.poster %}url({{ anime.poster }}) center / contain{% else %}linear-gradient(135deg, #667eea 0%, #764ba2 100%){% endif %}"></div>
                                <div class="card-rating">‚òÖ{{ "%.1f"|format(8.5 + loop.index * 0.1) }}</div>
                                <div class="card-overlay"></div>
                                <div class="card-title">{{ anime.name }}</div>
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-results">
                    <div class="no-results-icon">üîç</div>
                    <h3>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏—é</p>
                </div>
            {% endif %}
        {% else %}
            <!-- Popular Anime Section -->
            <div class="popular-section">
                <h2>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∞–Ω–∏–º–µ</h2>
                <div class="anime-grid">
                    <div class="anime-card">
                        <div class="card-image" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
                            <div class="card-rating">‚òÖ9.80</div>
                            <div class="card-overlay"></div>
                            <div class="card-title">One Piece</div>
                        </div>
                    </div>
                    <div class="anime-card">
                        <div class="card-image" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                            <div class="card-rating">‚òÖ9.60</div>
                            <div class="card-overlay"></div>
                            <div class="card-title">–ù–∞—Ä—É—Ç–æ</div>
                        </div>
                    </div>
                    <div class="anime-card">
                        <div class="card-image" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-rating">‚òÖ9.35</div>
                            <div class="card-overlay"></div>
                            <div class="card-title">–ú–∞–≥–∏—á–µ—Å–∫–∞—è –ë–∏—Ç–≤–∞</div>
                        </div>
                    </div>
                    <div class="anime-card">
                        <div class="card-image" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                            <div class="card-rating">‚òÖ9.50</div>
                            <div class="card-overlay"></div>
                            <div class="card-title">–ö–ª–∏–Ω–æ–∫, —Ä–∞—Å—Å–µ–∫–∞—é—â–∏–π –¥–µ–º–æ–Ω–æ–≤</div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </section>

    <!-- Loading Indicator -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>–ü–æ–∏—Å–∫...</p>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="/" class="nav-item">
            <div class="nav-icon">üè†</div>
            <span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
        </a>
        <a href="/mobile-search" class="nav-item active">
            <div class="nav-icon">üîç</div>
            <span class="nav-label">–ü–æ–∏—Å–∫</span>
        </a>
        <a href="#" class="nav-item">
            <div class="nav-icon">‚≠ê</div>
            <span class="nav-label">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
        </a>
        <a href="#" class="nav-item">
            <div class="nav-icon">üë§</div>
            <span class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
    </nav>

    <!-- WebApp JavaScript -->
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–ø—É—â–µ–Ω –ª–∏ WebApp
        const isWebApp = window.Telegram && window.Telegram.WebApp;
        let tg = null;

        if (isWebApp) {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
            tg = window.Telegram.WebApp;
            tg.ready();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–æ–∏—Å–∫–∞
        document.getElementById('searchButton').addEventListener('click', function() {
            const searchInput = document.getElementById('searchInput');
            const query = searchInput.value.trim();

            if (!query) {
                if (isWebApp) {
                    tg.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–Ω–∏–º–µ –¥–ª—è –ø–æ–∏—Å–∫–∞');
                } else {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–Ω–∏–º–µ –¥–ª—è –ø–æ–∏—Å–∫–∞');
                }
                return;
            }

            if (isWebApp) {
                // WebApp –ª–æ–≥–∏–∫–∞ - –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
                const searchData = {
                    action: 'search',
                    query: query,
                    timestamp: Date.now(),
                    user_id: tg.initDataUnsafe?.user?.id || null,
                    username: tg.initDataUnsafe?.user?.username || null
                };

                // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ WebApp
                tg.sendData(JSON.stringify(searchData));
            } else {
                // –û–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
                const form = document.createElement('form');
                form.method = 'GET';
                form.action = '/mobile-search';

                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'q';
                input.value = query;

                form.appendChild(input);
                document.body.appendChild(form);
                form.submit();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à–∏ Enter
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('searchButton').click();
            }
        });

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π –æ—á–∏—Å—Ç–∫–∏
        document.getElementById('searchInput').addEventListener('input', function() {
            const clearButton = document.getElementById('clearButton');
            clearButton.style.display = this.value ? 'block' : 'none';
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—á–∏—Å—Ç–∫–∏
        document.getElementById('clearButton').addEventListener('click', function() {
            document.getElementById('searchInput').value = '';
            this.style.display = 'none';
            document.getElementById('searchInput').focus();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            document.getElementById('searchInput').focus();
        });
    </script>

    <script src="static/js/mobile.js"></script>
</body>
</html>