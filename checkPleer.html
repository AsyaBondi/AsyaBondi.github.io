<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FreeAnime - –ü–ª–µ–µ—Ä</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/demo.css"/>
    <link
            rel="preload"
            as="font"
            crossorigin
            type="font/woff2"
            href="https://cdn.plyr.io/static/fonts/gordita-medium.woff2"
    />
    <link
            rel="preload"
            as="font"
            crossorigin
            type="font/woff2"
            href="https://cdn.plyr.io/static/fonts/gordita-bold.woff2"
    />
    <script>
        function getQueryStrings() {
            var assoc  = {};
            var decode = function (s) { return decodeURIComponent(s.replace(/\+/g, " ")); };
            var queryString = location.search.substring(1);
            var keyValues = queryString.split('&');

            for(var i in keyValues) {
                var key = keyValues[i].split('=');
                if (key.length > 1) {
                    assoc[decode(key[0])] = decode(key[1]);
                }
            }

            return assoc;
        }
        function addStylePl(){
            let st = "margin-top: var(--tg-content-safe-area-inset-top); margin-left: var(--tg-content-safe-area-inset-left); margin-bottom: var(--tg-content-safe-area-inset-bottom); margin-right: var(--tg-content-safe-area-inset-right);"
            document.getElementById('player').setAttribute('style',st)
        }
        function remStylePl(){
            document.getElementById('player').removeAttribute('style')
        }
    </script>
</head>
<body>
<script>
    window.Telegram.WebApp.requestFullscreen()
</script>
<div  style="margin-top: var(--tg-content-safe-area-inset-top);"></div>
<div id="container">
    <video controls crossorigin playsinline id="player">
        <source id="srAddLink" type="video/mp4" size="720"/>
    </video>
</div>
<div>

</div>
<div style="margin-bottom:24px; padding: 16px; background: var(--tg-theme-secondary-bg-color, #f5f5f5); border-radius: 12px;">
    <h2 style="margin-bottom: 12px; margin-top: 0; color: var(--tg-theme-text-color);">üìπ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∏–¥–µ–æ</h2>
    <div style="display: grid; gap: 8px;">
        <p style="margin: 0;"><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> <span id="nameAnime"></span></p>
        <p style="margin: 0;"><strong>–û–∑–≤—É—á–∫–∞:</strong> <span id="nameTr"></span></p>
        <p style="margin: 0;"><strong>–°–µ—Ä–∏—è:</strong> <span id="serNum"></span></p>
        <p style="margin: 0; color: var(--tg-theme-hint-color, #666); font-size: 14px;">–í–µ—Ä—Å–∏—è –ø–ª–µ–µ—Ä–∞: 1.0</p>
        <p style="margin: 0; color: var(--tg-theme-hint-color, #666); font-size: 14px;">üí° –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ –ø–ª–µ–µ—Ä—É - –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º</p>
    </div>
</div>

<div style="display: grid; gap: 8px;">
    <div style="display: flex; gap: 8px;">
        <button class="button js-shr" onclick="window.Telegram.WebApp.exitFullscreen()">üì± –í—ã–π—Ç–∏ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ</button>
        <button class="button js-shr" onclick="window.Telegram.WebApp.requestFullscreen()">üñ•Ô∏è –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω</button>
    </div>

    <div id="episodeControls" style="display: none;">
        <h3 style="margin-bottom: 8px;">üé¨ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–∏—è–º–∏</h3>
        <div style="display: flex; gap: 8px; justify-content: center;">
            <button class="button js-shr" id="prevEpisode" onclick="changeEpisode(-1)">‚¨ÖÔ∏è –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
            <button class="button js-shr" id="nextEpisode" onclick="changeEpisode(1)">–°–ª–µ–¥—É—é—â–∞—è ‚û°Ô∏è</button>
        </div>
    </div>

    <div style="display: flex; gap: 8px;">
        <button class="button js-shr" onclick="togglePlayPause()">‚èØÔ∏è –ü–∞—É–∑–∞/–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ</button>
        <button class="button js-shr" onclick="window.Telegram.WebApp.close()">‚ùå –ó–∞–∫—Ä—ã—Ç—å –ø–ª–µ–µ—Ä</button>
    </div>
</div>



<script>
    var qs = getQueryStrings();
    var currentEpisode = parseInt(qs['serNum']) || 1;
    var isSerial = qs['isSerial'] === 'true';
    var animeId = qs['animeId'];
    var translationId = qs['translationId'];

    document.getElementById('srAddLink').setAttribute('src', qs['link']);

    let nameAnime = document.getElementById('nameAnime');
    nameAnime.innerText = qs['nameAnime'];

    let nameTr = document.getElementById('nameTr');
    nameTr.innerText = qs['nameTr'];

    let serNum = document.getElementById('serNum');
    serNum.innerText = currentEpisode + (isSerial ? ' —Å–µ—Ä–∏—è' : '');

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—ã —Å–µ—Ä–∏–π –µ—Å–ª–∏ —ç—Ç–æ —Å–µ—Ä–∏–∞–ª
    if (isSerial) {
        document.getElementById('episodeControls').style.display = 'block';
        updateEpisodeButtons();
    }

    // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–µ–µ—Ä–æ–º
    function togglePlayPause() {
        const video = document.getElementById('player');
        if (video.paused) {
            video.play();
        } else {
            video.pause();
        }
    }

    function changeEpisode(direction) {
        const newEpisode = currentEpisode + direction;
        if (newEpisode < 1) return; // –ù–µ –¥–∞–µ–º —É–π—Ç–∏ –Ω–∏–∂–µ 1 —Å–µ—Ä–∏–∏

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–º–µ–Ω—É —Å–µ—Ä–∏–∏ —á–µ—Ä–µ–∑ WebApp
        window.Telegram.WebApp.sendData(JSON.stringify({
            action: 'change_episode',
            animeId: animeId,
            translationId: translationId,
            currentEpisode: currentEpisode,
            newEpisode: newEpisode
        }));

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        window.Telegram.WebApp.showAlert(`–ü–µ—Ä–µ—Ö–æ–¥ –∫ ${newEpisode} —Å–µ—Ä–∏–∏...`);
    }

    function updateEpisodeButtons() {
        const prevBtn = document.getElementById('prevEpisode');
        const nextBtn = document.getElementById('nextEpisode');

        // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É "–ü—Ä–µ–¥—ã–¥—É—â–∞—è" –µ—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è —Å–µ—Ä–∏—è
        prevBtn.disabled = currentEpisode <= 1;
        prevBtn.style.opacity = currentEpisode <= 1 ? '0.5' : '1';
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à
    document.addEventListener('keydown', function(event) {
        switch(event.code) {
            case 'Space':
                event.preventDefault();
                togglePlayPause();
                break;
            case 'ArrowLeft':
                if (isSerial) changeEpisode(-1);
                break;
            case 'ArrowRight':
                if (isSerial) changeEpisode(1);
                break;
            case 'KeyF':
                event.preventDefault();
                if (window.Telegram.WebApp.isFullscreen) {
                    window.Telegram.WebApp.exitFullscreen();
                } else {
                    window.Telegram.WebApp.requestFullscreen();
                }
                break;
        }
    });

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤–∏–¥–µ–æ
    document.getElementById('player').addEventListener('ended', function() {
        if (isSerial) {
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Ä–∏–∏
            setTimeout(() => {
                changeEpisode(1);
            }, 2000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 2 —Å–µ–∫—É–Ω–¥—ã
        }
    });

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –æ –≥–æ—Ä—è—á–∏—Ö –∫–ª–∞–≤–∏—à–∞—Ö
    setTimeout(() => {
        window.Telegram.WebApp.showAlert(
            '‚å®Ô∏è –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏:\n' +
            '‚Ä¢ –ü—Ä–æ–±–µ–ª - –ø–∞—É–∑–∞/–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ\n' +
            '‚Ä¢ ‚Üê ‚Üí - –ø—Ä–µ–¥—ã–¥—É—â–∞—è/—Å–ª–µ–¥—É—é—â–∞—è —Å–µ—Ä–∏—è\n' +
            '‚Ä¢ F - –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω'
        );
    }, 3000);
</script>
<script src="https://cdn.plyr.io/3.7.8/demo.js" crossorigin="anonymous"></script>
</body>
</html>